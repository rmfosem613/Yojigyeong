<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta lang="ko">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>메인 페이지</title>

    <!-- Semantic -->
    <link rel="stylesheet" type="text/css" href="semantic/semantic.min.css"> <!--배경 색을 지정함-->
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"
        integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
    <script src="semantic/semantic.min.js"></script>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/8.6.2/firebase-app.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/8.6.2/firebase-database.js"></script>
  </head>

  <body>
    <h1>메인 페이지 불러오기</h1>
    <button type="button" onclick="location.href='recent.html'">나라별 최신 정보 페이지로 이동</button>

    <div class="ui modal">
      <i class="close icon"></i>
      <div class="header">
        나라 정보
      </div>
      <div class="content">
        <div class="description" id="jsonModal">
        </div>
      </div>
      <div class="actions">
        <div class="ui black button">
          확인
        </div>
      </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
    <script src="node_modules/datamaps/dist/datamaps.world.min.js"></script>
    <div id="container" style="position: relative; width: 500px; height: 300px;"></div>
    <script>
      var map = new Datamap({
          element: document.getElementById('container'),
          fills: {
              HIGH: '#FFEEE4',
              LOW: '#FFEEE4',
              MEDIUM: '#F17F42',
              UNKNOWN: 'rgb(0,0,0)',
              defaultFill: '#8B8B8B'
          },
          // 하이라이트
          geographyConfig: {
              highlightFillColor: '#FFEEE4',
              highlightBorderColor: '#CE6D39'
          },
          // 클릭 이벤트?
          done: function(datamap) {
            datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {
               $.getJSON('./Json/recentNews.json', function (json) {
                var countContent = 0;
                for (var counter = 0; counter < json.length; counter++) {  //헤더, 최신 타이틀, 업데이트 날짜
                  if(geography.properties.name == json[counter].countryEnName){
                    $('#jsonModal').append('<div class="ui header" id="pre"> - ' + json[counter].countryName + '</div>');
                    $('#jsonModal').append('<p id="pre"> <b>최신 타이틀 : </b>' + json[counter].title +"</p>");
                    $('#jsonModal').append('<p id="pre"> <b>업데이트 날짜 : </b>' + json[counter].wrtDt +"</p>");
                    break;
                  }
                }
                for (var counter = 0; counter < json.length; counter++) {
                  if(geography.properties.name == json[counter].countryEnName){
                    countContent += 1;
                  }
                }
                $('#jsonModal').append('<p id="pre"> <b>게시글 수 : </b>' + countContent + "</p>");
                $('.ui.modal')
                .modal('attach events', '.black.button')  // '확인' 버튼 동작
                .modal('show');
              });
              $('p').remove('#pre');
              $('div').remove('#pre');
            });
          }
      });
  </script>   
  </body>
</html>
